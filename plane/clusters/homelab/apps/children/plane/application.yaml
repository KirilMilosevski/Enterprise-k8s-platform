apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: plane
  namespace: argocd
spec:
  project: default

  sources:
    # Source 1: Plane Helm chart (NO ingress here)
    - repoURL: https://helm.plane.so
      chart: plane-ce
      targetRevision: ">=1.0.0"
      helm:
        values: |
          ingress:
            enabled: false
            appHost: ""
            minioHost: ""
            ingressClass: ""

          postgres:
            storageClass: local-path
          redis:
            storageClass: local-path
          minio:
            storageClass: local-path

    # Source 2: Your Git repo (custom ingress + extras)
    - repoURL: https://github.com/KirilMilosevski/Plane-GitOps-Kubernetes.git
      targetRevision: main
      path: plane/clusters/homelab/ingress

  destination:
    server: https://kubernetes.default.svc
    namespace: plane

  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - ApplyOutOSyncOnly=true
      - PruneLast=true

  ignoreDifferences:
    - group: batch
      kind: Job
      jqPathExpressions:
        - .spec.template
        - .spec.template.metadata.labels

